openapi: 3.1.0

info:
  title: T-Shirt E-Commerce API
  version: 1.0.0
  description: |
    A RESTful API for managing an e-commerce platform with product catalog, 
    shopping cart, order management, and payment processing via Stripe.

    ## Authentication
    Most endpoints require JWT authentication via Bearer token in the Authorization header.
    
    ## User Roles
    - **Client**: Regular users who can browse, purchase, and manage their own data
    - **Manager**: Administrative users with product and order management capabilities
    
    ## Image Upload Limits
    - **Max file size**: 5MB
    - **Accepted formats**: JPEG, PNG, WebP
    - **Recommended dimensions**: 1200x1200px minimum
    
    ## Pagination
    - **Default limit**: 20 items per page
    - **Maximum limit**: 100 items per page
    - **Page numbering**: Starts at 1

servers:
  - url: /api/v1
    description: API v1 base path

tags:
  - name: Authentication
    description: User registration, login, password management
  - name: User Profile
    description: User profile and address management
  - name: Categories
    description: Product category management
  - name: Products
    description: Product catalog operations
  - name: Product Variants
    description: Product variant management
  - name: Product Images
    description: Product image management
  - name: Favorites
    description: Product wishlist/favorites
  - name: Cart
    description: Shopping cart management
  - name: Orders
    description: Order creation and management
  - name: Payments
    description: Payment processing via Stripe
  - name: Webhooks
    description: External webhook endpoints

paths:
  /auth/sign-up:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: |
        **üåê Public**
        
        Creates a new user account and returns an access token for immediate authentication.
        Validates email format and password strength (minimum 8 characters).
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type:
                - object
                - "null"
              required:
                - email
                - password
                - full_name
              properties:
                email:
                  type: string
                  format: email
                  examples:
                    - alex@example.com
                password:
                  type: string
                  format: password
                  minLength: 8
                  examples:
                    - securePassword123!
                full_name:
                  type: string
                  examples:
                    - Alex Developer
      responses:
        '201':
          description: User successfully registered
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    description: JWT access token for API authentication
                    examples:
                      - eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "Password must be at least 8 characters"
                  path: "/api/v1/auth/sign-up"
        '409':
          description: Email already registered
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 409
                error:
                  code: "EMAIL_ALREADY_EXISTS"
                  message: "Email already in use"
                  path: "/api/v1/auth/sign-up"

  /auth/sign-in:
    post:
      tags:
        - Authentication
      summary: Authenticate user
      description: |
        **üåê Public**
        
        Authenticates a user with email and password. Returns access token and refresh token.
      operationId: loginUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  examples:
                    - alex@example.com
                password:
                  type: string
                  format: password
                  examples:
                    - securePassword123!
      responses:
        '200':
          description: Successfully authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    examples:
                      - eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  refresh_token:
                    type: string
                    examples:
                      - rHt8KqP9mN3xL2wY...
                  user:
                    $ref: '#/components/schemas/User'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "Email and password are required"
                  path: "/api/v1/auth/sign-in"
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "INVALID_CREDENTIALS"
                  message: "Invalid email or password"
                  path: "/api/v1/auth/sign-in"

  /auth/sign-out:
    post:
      tags:
        - Authentication
      summary: Sign out user
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Invalidates the refresh token to prevent future token refresh.
      operationId: signOutUser
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - refresh_token
              properties:
                refresh_token:
                  type: string
                  description: Refresh token to invalidate
                  examples:
                    - rHt8KqP9mN3xL2wY...
      responses:
        '200':
          description: Successfully signed out
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Logged out successfully
        '401':
          description: Unauthorized or invalid token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/auth/sign-out"

  /auth/forgot-password:
    post:
      tags:
        - Authentication
      summary: Request password reset
      description: |
        **üåê Public**
        
        Sends a password reset link to the user's email if the account exists.
        Always returns success to prevent email enumeration attacks.
      operationId: forgotPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  examples:
                    - alex@example.com
      responses:
        '200':
          description: Request processed (email sent if account exists)
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - If the email exists, a reset link has been sent
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: ""
                  path: "/api/v1/auth/sign-in"

  /auth/reset-password:
    post:
      tags:
        - Authentication
      summary: Reset password with token
      description: |
        **üåê Public**
        
        Resets user password using the token from the password reset email.
        Sends confirmation email upon successful reset.
      operationId: resetPassword
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - token
                - new_password
              properties:
                token:
                  type: string
                  description: Token from password reset email
                  examples:
                    - abc123def456...
                new_password:
                  type: string
                  format: password
                  minLength: 8
                  examples:
                    - newSecurePassword123!
      responses:
        '200':
          description: Password successfully reset
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Password successfully updated
        '400':
          description: Invalid or expired token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_RESET_TOKEN"
                  message: "Reset token is invalid or has expired"
                  path: "/api/v1/auth/reset-password"

  /auth/refresh:
    post:
      tags:
        - Authentication
      summary: Refresh access token
      description: |
        **üåê Public**
        
        Generates a new access token using a valid refresh token.
        The refresh token must be sent in the Authorization header.
      operationId: refreshToken
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Token refreshed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    examples:
                      - eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                  refresh_token:
                    type: string
                    examples:
                      - rHt8KqP9mN3xL2wY...
        '401':
          description: Invalid or expired refresh token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "INVALID_REFRESH_TOKEN"
                  message: "Refresh token is invalid or expired"
                  path: "/api/v1/auth/refresh"

  /me:
    get:
      tags:
        - User Profile
      summary: Get current user profile
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Returns the authenticated user's profile information.
      operationId: getUserProfile
      security:
        - bearerAuth: []
      responses:
        '200':
          description: User profile retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/me"
    
    patch:
      tags:
        - User Profile
      summary: Update user profile
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Updates user profile information. All fields are optional.
        Email changes may require verification depending on implementation.
      operationId: updateUserProfile
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                full_name:
                  type: string
                  examples:
                    - Alexander Developer
                email:
                  type: string
                  format: email
                  examples:
                    - newemail@example.com
      responses:
        '200':
          description: Profile successfully updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserProfile'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/me"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/me"
        '409':
          description: Email already in use by another account
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 409
                error:
                  code: "EMAIL_ALREADY_EXISTS"
                  message: "Email already in use"
                  path: "/api/v1/me"

  /me/change-password:
    patch:
      tags:
        - User Profile
      summary: Change user password
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Changes the authenticated user's password. Requires current password for verification.
        Sends email notification upon successful change.
      operationId: changePassword
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - current_password
                - new_password
              properties:
                current_password:
                  type: string
                  format: password
                  examples:
                    - oldPassword123!
                new_password:
                  type: string
                  format: password
                  minLength: 8
                  examples:
                    - newSecurePassword123!
      responses:
        '200':
          description: Password successfully changed
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Password successfully changed
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "The new password must have at leas 8 characters"
                  path: "/api/v1/me/change-password"
        '401':
          description: Current password is incorrect or unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "INVALID_PASSWORD"
                  message: "Current password is incorrect"
                  path: "/api/v1/me/change-password"

  /me/addresses:
    get:
      tags:
        - User Profile
      summary: List user addresses
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Returns all saved addresses for the authenticated user.
      operationId: listUserAddresses
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Addresses retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  addresses:
                    type: array
                    items:
                      $ref: '#/components/schemas/Address'
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/me/addresses"
    
    post:
      tags:
        - User Profile
      summary: Add new address
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Adds a new shipping/billing address for the authenticated user.
      operationId: addUserAddress
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddressInput'
      responses:
        '201':
          description: Address created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Address'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/me/addresses"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/me/addresses"

  /me/addresses/{id}:
    patch:
      tags:
        - User Profile
      summary: Update address
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Updates a saved address for the authenticated user. All fields are optional.
      operationId: updateUserAddress
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Address ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                address_line1:
                  type: string
                  examples:
                    - 456 New Street
                city:
                  type: string
                  examples:
                    - San Salvador
                country:
                  type: string
                  description: ISO 3166-1 alpha-2 country code
                  examples:
                    - SV
                postal_code:
                  type: string
                  examples:
                    - "11012"
      responses:
        '200':
          description: Address updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Address'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/me/addresses/{id}"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/me/addresses/{id}"
        '404':
          description: Address not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "ADDRESS_NOT_FOUND"
                  message: "Address not found"
                  path: "/api/v1/me/addresses/{id}"

    delete:
      tags:
        - User Profile
      summary: Remove address
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Deletes a saved address for the authenticated user.
      operationId: removeUserAddress
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Address ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Address deleted successfully
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/me/addresses/{id}"
        '404':
          description: Address not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/me/addresses/{id}"

  /categories:
    get:
      tags:
        - Categories
      summary: List all categories
      description: |
        **üåê Public**
        
        Returns all product categories with computed product counts.
        Publicly accessible without authentication.
      operationId: listCategories
      responses:
        '200':
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  categories:
                    type: array
                    items:
                      $ref: '#/components/schemas/CategoryWithCount'
    
    post:
      tags:
        - Categories
      summary: Create category
      description: |
        **üîê Authentication Required: Manager**
        
        Creates a new product category. Manager access required.
      operationId: createCategory
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  examples:
                    - Summer Collection 2026
      responses:
        '201':
          description: Category created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/categories"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/categories"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Manager access required"
                  path: "/api/v1/categories"
        '409':
          description: Category name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 409
                error:
                  code: "CATEGORY_ALREADY_EXISTS"
                  message: "Category name already exists"
                  path: "/api/v1/categories"

  /categories/{id}:
    get:
      tags:
        - Categories
      summary: Get category details
      description: |
        **üåê Public**
        
        Returns detailed information about a specific category.
      operationId: getCategoryDetails
      parameters:
        - name: id
          in: path
          required: true
          description: Category ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Category details retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/categories/{id}"
    
    patch:
      tags:
        - Categories
      summary: Update category
      description: |
        **üîê Authentication Required: Manager**
        
        Updates category information. Manager access required.
      operationId: updateCategory
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Category ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  examples:
                    - Winter Collection
      responses:
        '200':
          description: Category updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/categories/{id}"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/categories/{id}"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/categories/{id}"
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/categories/{id}"
        '409':
          description: Category name already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 409
                error:
                  code: "CATEGORY_ALREADY_EXISTS"
                  message: "Category name already exists"
                  path: "/api/v1/categories/{id}"
    
    delete:
      tags:
        - Categories
      summary: Delete category
      description: |
        **üîê Authentication Required: Manager**
        
        Deletes a category. Manager access required.
        May fail if category contains products depending on implementation.
      operationId: deleteCategory
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Category ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Category deleted successfully
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/categories/{id}"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/categories/{id}"
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/categories/{id}"
        '409':
          description: Category cannot be deleted (contains products)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 409
                error:
                  code: "CATEGORY_HAS_PRODUCTS"
                  message: "Cannot delete category with existing products"
                  path: "/api/v1/categories/{id}"

  /products:
    get:
      tags:
        - Products
      summary: List products
      description: |
        **üåê Public**
        
        Returns paginated list of products with filtering and search capabilities.
        Publicly accessible. Returns only active products unless accessed by manager.
        
        **Pagination limits:**
        - Default: 20 items per page
        - Maximum: 100 items per page
      operationId: listProducts
      parameters:
        - name: page
          in: query
          description: Page number for pagination (starts at 1)
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of items per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: search
          in: query
          description: Search term for product title or description
          schema:
            type: string
            examples:
              - developer shirt
        - name: category_id
          in: query
          description: Filter products by category UUID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Products retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/ProductListItem'
                  meta:
                    $ref: '#/components/schemas/PaginationMeta'
        '400':
          description: Invalid query parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/products"
    
    post:
      tags:
        - Products
      summary: Create product
      description: |
        **üîê Authentication Required: Manager**
        
        Creates a new product with options and variants. Manager access required.
        Options define selectable attributes (e.g., Color, Size).
        Variants represent specific combinations with individual pricing and stock.
      operationId: createProduct
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ProductInput'
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductCreated'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/products"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/products"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/products"

  /products/{id}:
    get:
      tags:
        - Products
      summary: Get product details
      description: |
        **üåê Public**
        
        Returns complete product information including all variants, options, and images.
        Publicly accessible. Variants include combination mappings for UI selection.
      operationId: getProductDetails
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Product details retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductDetails'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/products/{id}"
    
    patch:
      tags:
        - Products
      summary: Update product
      description: |
        **üîê Authentication Required: Manager**
        
        Updates product information including activation status.
        Manager access required. Set is_active to false to disable product.
      operationId: updateProduct
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                  examples:
                    - Updated Developer T-Shirt
                description:
                  type: string
                  examples:
                    - Premium 100% cotton, updated description
                is_active:
                  type: boolean
                  description: Set to false to disable/hide product
                  examples:
                    - true
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  title:
                    type: string
                  description:
                    type: string
                  is_active:
                    type: boolean
                  updated_at:
                    type: string
                    format: date-time
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/products/{id}"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/products/{id}"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/products/{id}"
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/products/{id}"
    
    delete:
      tags:
        - Products
      summary: Delete product
      description: |
        **üîê Authentication Required: Manager**
        
        Deletes a product and all associated variants and images.
        Manager access required.
      operationId: deleteProduct
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Product deleted successfully
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/products/{id}"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/products/{id}"
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/products/{id}"

  /products/{id}/variants:
    post:
      tags:
        - Product Variants
      summary: Create product variant
      description: |
        **üîê Authentication Required: Manager**
        
        Adds a new variant to an existing product. Manager access required.
        Variant represents a specific combination of options with unique SKU, price, and stock.
      operationId: createProductVariant
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/VariantInput'
      responses:
        '201':
          description: Variant created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Variant'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/products/{id}/variants"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/products/{id}/variants"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/products/{id}/variants"
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/products/{id}/variants"
        '409':
          description: Variant with same option combination already exists or SKU already in use
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 409
                error:
                  code: "VARIANT_ALREADY_EXISTS"
                  message: "Variant with same option combination already exists"
                  path: "/api/v1/products/{id}/variants"

  /product-variants/{id}:
    patch:
      tags:
        - Product Variants
      summary: Update product variant
      description: |
        **üîê Authentication Required: Manager**
        
        Updates variant price, stock quantity, and image URL. Manager access required.
        SKU and option combinations cannot be changed after creation.
      operationId: updateProductVariant
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Variant ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                price:
                  type: integer
                  description: Price in cents
                  examples:
                    - 2299
                stock_quantity:
                  type: integer
                  minimum: 0
                  examples:
                    - 25
                image_url:
                  type: string
                  format: uri
                  description: URL of variant-specific image
                  examples:
                    - https://cdn.example.com/images/variant-123.jpg
      responses:
        '200':
          description: Variant updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Variant'
        '400':
          description: Invalid input data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_INPUT"
                  message: "(the invalid fields)"
                  path: "/api/v1/product-variants/{id}"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/product-variants/{id}"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/product-variants/{id}"
        '404':
          description: Variant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/product-variants/{id}"

    delete:
      tags:
        - Product Variants
      summary: Delete variant
      description: |
        **üîê Authentication Required: Manager**
        
        Deletes a product variant. Manager access required.
        Cannot delete if variant is the last one for the product.
      operationId: deleteProductVariant
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Variant ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Variant deleted successfully
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/product-variants/{id}"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/product-variants/{id}"
        '404':
          description: Variant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/product-variants/{id}"
        '409':
          description: Cannot delete last variant of product
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 409
                error:
                  code: "CANNOT_DELETE_LAST_VARIANT"
                  message: "Cannot delete the last variant of a product"
                  path: "/api/v1/product-variants/{id}"

  /products/{id}/images:
    post:
      tags:
        - Product Images
      summary: Upload product image
      description: |
        **üîê Authentication Required: Manager**
        
        Uploads a general product image (not variant-specific). Manager access required.
        These images appear in the product gallery.
        
        **Upload limits:**
        - Max file size: 5MB
        - Accepted formats: JPEG, PNG, WebP
        - Recommended dimensions: 1200x1200px minimum
      operationId: uploadProductImage
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              required:
                - file
              properties:
                file:
                  type: string
                  format: binary
                  description: Image file (JPEG, PNG, WebP - max 5MB)
      responses:
        '201':
          description: Image uploaded successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProductImage'
        '400':
          description: Invalid file format or size exceeds limit
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_FILE"
                  message: "File size exceeds 5MB limit or invalid format"
                  path: "/api/v1/products/{id}/images"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/products/{id}/images"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/products/{id}/images"
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/products/{id}/images"

  /product-images/{id}:
    delete:
      tags:
        - Product Images
      summary: Delete product image
      description: |
        **üîê Authentication Required: Manager**
        
        Deletes a general product image. Manager access required.
      operationId: deleteProductImage
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Image ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Image deleted successfully
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/product-images/{id}"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/product-images/{id}"
        '404':
          description: Image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/product-images/{id}"

  /products/{id}/favorites:
    post:
      tags:
        - Favorites
      summary: Add product to favorites
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Adds a product to the authenticated user's favorites/wishlist.
      operationId: addProductToFavorites
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
            format: uuid
      responses:
        '201':
          description: Product added to favorites
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    examples:
                      - Added to favorites
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/products/{id}/favorites"
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/products/{id}/favorites"
        '409':
          description: Product already in favorites
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 409
                error:
                  code: "ALREADY_IN_FAVORITES"
                  message: "Product already in favorites"
                  path: "/api/v1/products/{id}/favorites"
    
    delete:
      tags:
        - Favorites
      summary: Remove product from favorites
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Removes a product from the authenticated user's favorites.
      operationId: removeProductFromFavorites
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Product ID
          schema:
            type: string
            format: uuid
      responses:
        '204':
          description: Product removed from favorites
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/products/{id}/favorites"
        '404':
          description: Product not found or not in favorites
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/products/{id}/favorites"

  /cart:
    get:
      tags:
        - Cart
      summary: Get shopping cart
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Returns the current user's shopping cart with all items and calculated totals.
        Each user has only one active cart that persists across sessions.
      operationId: getCart
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cart retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/cart"
    
    delete:
      tags:
        - Cart
      summary: Clear shopping cart
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Removes all items from the cart. The cart itself remains but becomes empty.
      operationId: clearCart
      security:
        - bearerAuth: []
      responses:
        '204':
          description: Cart cleared successfully
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/cart"

  /cart/items:
    post:
      tags:
        - Cart
      summary: Add item to cart
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Adds a product variant to the cart with the specified quantity.
        If the variant already exists in the cart, the quantity is incremented.
        Returns the updated cart with recalculated totals.
      operationId: addCartItem
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - product_variant_id
                - quantity
              properties:
                product_variant_id:
                  type: string
                  format: uuid
                  description: UUID of the product variant to add
                quantity:
                  type: integer
                  minimum: 1
                  examples:
                    - 2
      responses:
        '200':
          description: Item added to cart successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '400':
          description: Invalid quantity or insufficient stock
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INSUFFICIENT_STOCK"
                  message: "Requested quantity exceeds available stock"
                  path: "/api/v1/cart/items"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/cart/items"
        '404':
          description: Product variant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/cart/items"

  /cart/items/{id}:
    patch:
      tags:
        - Cart
      summary: Update cart item quantity
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Updates the quantity of a specific cart item (sets to exact quantity, not increment).
        Returns the updated cart with recalculated totals.
      operationId: updateCartItemQuantity
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Cart item ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - quantity
              properties:
                quantity:
                  type: integer
                  minimum: 1
                  description: New quantity (sets to this exact value)
                  examples:
                    - 5
      responses:
        '200':
          description: Cart item updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '400':
          description: Invalid quantity or insufficient stock
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INSUFFICIENT_STOCK"
                  message: "Requested quantity exceeds available stock"
                  path: "/api/v1/cart/items/{id}"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/cart/items/{id}"
        '404':
          description: Cart item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/cart/items/{id}"
    
    delete:
      tags:
        - Cart
      summary: Remove item from cart
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Removes a specific item from the cart completely.
        Returns the updated cart with recalculated totals.
      operationId: removeCartItem
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Cart item ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Item removed from cart successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Cart'
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/cart/items/{id}"
        '404':
          description: Cart item not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/cart/items/{id}"

  /orders:
    get:
      tags:
        - Orders
      summary: List orders
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Returns orders for the authenticated user.
        - **Clients** see only their own orders
        - **Managers** see all orders across all users
      operationId: listOrders
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Orders retrieved successfully
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/OrderSummary'
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/orders"
    
    post:
      tags:
        - Orders
      summary: Create order (checkout)
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Creates an order from the current cart contents using a saved address.
        Cart is automatically cleared upon successful order creation.
        Product details and prices are captured as snapshots for historical accuracy.
        
        Order is created with status: **PENDING**
      operationId: createOrder
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - shipping_address_id
              properties:
                shipping_address_id:
                  type: string
                  format: uuid
                  description: ID of a saved user address to use for shipping
                  examples:
                    - 3fa85f64-5717-4562-b3fc-2c963f66afa6
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetails'
        '400':
          description: Cart is empty or invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "EMPTY_CART"
                  message: "Cannot create order with empty cart"
                  path: "/api/v1/orders"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/orders"
        '404':
          description: Address not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/orders"

  /orders/{id}:
    get:
      tags:
        - Orders
      summary: Get order details
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Returns detailed information about a specific order.
        - **Clients** can only access their own orders
        - **Managers** can access any order
      operationId: getOrderDetails
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Order ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Order details retrieved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderDetails'
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/orders/{id}"
        '403':
          description: Not authorized to access this order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Not authorized to access this order"
                  path: "/api/v1/orders/{id}"
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/orders/{id}"

  /orders/{id}/status:
    patch:
      tags:
        - Orders
      summary: Update order status
      description: |
        **üîê Authentication Required: Manager**
        
        Updates the status of an order. Manager access required.
        
        **Status workflow:**
        - **PENDING**: Order created, awaiting payment
        - **CANCELLED**: Order cancelled by user or system
        - **PAID**: Payment confirmed
        - **SHIPPED**: Order dispatched for delivery
        - **DELIVERED**: Order received by customer
      operationId: updateOrderStatus
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Order ID
          schema:
            type: string
            format: uuid
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum:
                    - PENDING
                    - CANCELLED
                    - PAID
                    - SHIPPED
                    - DELIVERED
                  examples:
                    - SHIPPED
      responses:
        '200':
          description: Order status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  id:
                    type: string
                    format: uuid
                  status:
                    type: string
                    enum:
                      - PENDING
                      - CANCELLED
                      - PAID
                      - SHIPPED
                      - DELIVERED
                  updated_at:
                    type: string
                    format: date-time
        '400':
          description: Invalid status or invalid status transition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_STATUS_TRANSITION"
                  message: "Cannot change status from DELIVERED to PENDING"
                  path: "/api/v1/orders/{id}/status"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/orders/{id}/status"
        '403':
          description: Forbidden - manager access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/orders/{id}/status"
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/orders/{id}/status"

  /orders/{id}/payment-intent:
    post:
      tags:
        - Payments
      summary: Create payment intent
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Creates a Stripe payment intent for an order. Returns client secret
        for frontend payment processing.
        
        - **Clients** can only create payment intents for their own orders
        - **Managers** can create payment intents for any order
      operationId: createPaymentIntent
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Order ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Payment intent created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  client_secret:
                    type: string
                    description: Stripe client secret for payment processing
                    examples:
                      - pi_3L7W8K2eZvKylo2C1_secret_xyz...
                  amount:
                    type: integer
                    description: Payment amount in cents
                    examples:
                      - 5000
                  currency:
                    type: string
                    description: Payment currency (ISO 4217)
                    examples:
                      - usd
        '400':
          description: Order already paid or invalid state
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "ORDER_ALREADY_PAID"
                  message: "Order has already been paid"
                  path: "/api/v1/orders/{id}/payment-intent"
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/orders/{id}/payment-intent"
        '403':
          description: Not authorized to create payment for this order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Not authorized to create payment for this order"
                  path: "/api/v1/orders/{id}/payment-intent"
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/orders/{id}/payment-intent"

  /orders/{id}/payment:
    get:
      tags:
        - Payments
      summary: Get payment details
      description: |
        **üîê Authentication Required: Client/Manager**
        
        Returns payment information for a specific order.
        
        - **Clients** can only view payment details for their own orders
        - **Managers** can view payment details for any order
      operationId: getPaymentDetails
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Order ID
          schema:
            type: string
            format: uuid
      responses:
        '200':
          description: Payment details retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Payment'
        '401':
          description: Unauthorized - invalid or missing token
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 401
                error:
                  code: "UNAUTHORIZED"
                  message: "Invalid or missing authentication token"
                  path: "/api/v1/orders/{id}/payment"
        '403':
          description: Not authorized to view payment for this order
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 403
                error:
                  code: "FORBIDDEN"
                  message: "Insufficient permissions"
                  path: "/api/v1/orders/{id}/payment"
        '404':
          description: Order or payment not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 404
                error:
                  code: "NOT_FOUND"
                  message: "Resource not found"
                  path: "/api/v1/orders/{id}/payment"

  /webhooks/stripe:
    post:
      tags:
        - Webhooks
      summary: Stripe webhook endpoint
      description: |
        **üåê Public (Stripe-only)**
        
        Receives payment events from Stripe. Automatically updates order and payment status
        based on payment events. This endpoint is called by Stripe servers only
        and should be secured with webhook signature verification.
        
        **Common events handled:**
        - `payment_intent.succeeded` - Payment completed successfully
        - `payment_intent.payment_failed` - Payment attempt failed
        - `payment_intent.canceled` - Payment intent was canceled
        - `charge.refunded` - Payment was refunded
      operationId: handleStripeWebhook
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: Stripe Event object
              required:
                - id
                - type
                - data
              properties:
                id:
                  type: string
                  description: Unique identifier for the event
                  examples:
                    - evt_1MqLN82eZvKYlo2C8JKz9Xz7
                type:
                  type: string
                  description: Event type
                  enum:
                    - payment_intent.succeeded
                    - payment_intent.payment_failed
                    - payment_intent.canceled
                    - charge.refunded
                  examples:
                    - payment_intent.succeeded
                data:
                  type: object
                  description: Event data containing the payment intent or charge object
                  properties:
                    object:
                      type: object
                      description: The resource (PaymentIntent or Charge) related to the event
                created:
                  type: integer
                  description: Unix timestamp of when the event was created
                  examples:
                    - 1680000000
      responses:
        '200':
          description: Webhook processed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  received:
                    type: boolean
                    examples:
                      - true
        '400':
          description: Invalid webhook signature or malformed payload
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                status: 400
                error:
                  code: "INVALID_WEBHOOK_SIGNATURE"
                  message: "Invalid webhook signature"
                  path: "/api/v1/webhooks/stripe"

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT access token obtained from login or registration

  schemas:
    ErrorResponse:
      type: object
      required:
        - status
        - error
      properties:
        status:
          type: integer
          description: HTTP status code
          examples:
            - 404
        error:
          type: object
          required:
            - code
            - message
            - path
          properties:
            code:
              type: string
              description: Machine-readable error code for client-side handling
              examples:
                - "RESOURCE_NOT_FOUND"
            message:
              type: string
              description: Human-readable error message
              examples:
                - "The requested resource was not found"
            path:
              type: string
              description: API endpoint path where the error occurred
              examples:
                - "/api/v1/products/12345"

    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        full_name:
          type: string
        role:
          type: string
          enum:
            - client
            - manager

    UserProfile:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        full_name:
          type: string
        role:
          type: string
          enum:
            - client
            - manager

    Address:
      type: object
      properties:
        id:
          type: string
          format: uuid
        address_line1:
          type: string
          examples:
            - 123 Tech Boulevard
        city:
          type: string
          examples:
            - San Salvador
        country:
          type: string
          description: ISO 3166-1 alpha-2 country code
          examples:
            - SV
        postal_code:
          type: string
          examples:
            - "11011"
        created_at:
          type: string
          format: date-time

    AddressInput:
      type: object
      required:
        - address_line1
        - city
        - country
        - postal_code
      properties:
        address_line1:
          type: string
          examples:
            - 123 Tech Boulevard
        city:
          type: string
          examples:
            - San Salvador
        country:
          type: string
          description: ISO 3166-1 alpha-2 country code
          examples:
            - SV
        postal_code:
          type: string
          examples:
            - "11011"

    Category:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          examples:
            - Summer Collection 2026
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    CategoryWithCount:
      type: object
      properties:
        id:
          type: string
          format: uuid
        name:
          type: string
          examples:
            - Summer Collection 2026
        product_count:
          type: integer
          description: Computed count of active products in this category
          examples:
            - 15

    ProductInput:
      type: object
      required:
        - title
        - description
        - category_ids
        - options
      properties:
        title:
          type: string
          examples:
            - Developer T-Shirt
        description:
          type: string
          examples:
            - Premium 100% cotton developer t-shirt with custom design
        category_ids:
          type: array
          description: Array of category UUIDs to associate with this product
          items:
            type: string
            format: uuid
          examples:
            - 3fa85f64-5717-4562-b3fc-2c963f66afa6
        options:
          type: array
          description: Product option groups (e.g., Color, Size) that define variant combinations
          items:
            type: object
            required:
              - title
              - values
            properties:
              title:
                type: string
                examples:
                  - Color
              values:
                type: array
                items:
                  type: string
                examples:
                  - Red
                  - Black
                  - Blue

    ProductCreated:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        created_at:
          type: string
          format: date-time
        options:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              title:
                type: string
                examples:
                  - Color
        variants_count:
          type: integer
          description: Number of variants created for this product
          examples:
            - 6

    ProductListItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          examples:
            - Developer T-Shirt
        image_url:
          type:
            - string
            - "null"
          format: uri
          description: URL of the first product image
          examples:
            - https://cdn.example.com/images/product-1.jpg
        price_starts_at:
          type:
            - integer
            - "null"
          description: Minimum price across all variants in cents
          examples:
            - 1999
        category_names:
          type: array
          items:
            type: string
          examples:
            - Summer Collection
            - T-Shirts

    ProductDetails:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
          examples:
            - Developer T-Shirt
        description:
          type: string
          examples:
            - Premium 100% cotton developer t-shirt
        is_active:
          type: boolean
          examples:
            - true
        images:
          type: array
          description: General product images (gallery)
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              url:
                type: string
                format: uri
                examples:
                  - https://cdn.example.com/images/product-1.jpg
        options:
          type: array
          description: Selectable product options for UI rendering
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              title:
                type: string
                examples:
                  - Color
              values:
                type: array
                items:
                  type: object
                  properties:
                    id:
                      type: string
                      format: uuid
                    value:
                      type: string
                      examples:
                        - Black
        variants:
          type: array
          description: Available variants with option combination mappings
          items:
            type: object
            properties:
              id:
                type: string
                format: uuid
              sku:
                type: string
                examples:
                  - DEV-BLK-L
              price:
                type: integer
                description: Price in cents
                examples:
                  - 2299
              stock:
                type: integer
                examples:
                  - 50
              image_url:
                type:
                  - string
                  - "null"
                format: uri
                description: Variant-specific image URL
                examples:
                  - https://cdn.example.com/images/variant-123.jpg

    VariantInput:
      type: object
      required:
        - sku
        - price
        - stock_quantity
        - option_values
      properties:
        sku:
          type: string
          description: Unique stock keeping unit identifier
          examples:
            - DEV-BLK-L
        price:
          type: integer
          description: Price in cents
          examples:
            - 2500
        stock_quantity:
          type: integer
          minimum: 0
          examples:
            - 50
        image_url:
          type: string
          format: uri
          description: Optional variant-specific image URL
          examples:
            - https://cdn.example.com/images/variant-black-large.jpg
        option_values:
          type: array
          description: List of option values defining this variant
          items:
            type: object
            required:
              - option_id
              - value
            properties:
              option_id:
                type: string
                format: uuid
                description: ID of the product option
              value:
                type: string
                description: Value for this option
          examples:
            - option_id: 3fa85f64-5717-4562-b3fc-2c963f66afa6
              value: Black
            - option_id: 4fa85f64-5717-4562-b3fc-2c963f66afa7
              value: Large

    Variant:
      type: object
      properties:
        id:
          type: string
          format: uuid
        sku:
          type: string
          examples:
            - DEV-BLK-L
        price:
          type: integer
          description: Price in cents
          examples:
            - 2299
        stock_quantity:
          type: integer
          examples:
            - 50
        image_url:
          type:
            - string
            - "null"
          format: uri
          description: Variant-specific image URL
          examples:
            - https://cdn.example.com/images/variant-123.jpg
        option_values:
          type:
            - array
            - "null"
          description: The resolved option values for this variant
          items:
            type: object
            properties:
              option_id:
                type: string
                format: uuid
              option_title:
                type: string
                examples:
                  - Color
              value:
                type: string
                examples:
                  - Black
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    ProductImage:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product_id:
          type: string
          format: uuid
        url:
          type: string
          format: uri
          examples:
            - https://cdn.example.com/images/product-gallery-1.jpg
        updated_at:
          type: string
          format: date-time

    Cart:
      type: object
      properties:
        id:
          type: string
          format: uuid
        total_amount:
          type: integer
          description: Total cart value in cents (computed)
          examples:
            - 4598
        items:
          type: array
          items:
            $ref: '#/components/schemas/CartItem'

    CartItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product_variant_id:
          type: string
          format: uuid
        sku:
          type: string
          examples:
            - DEV-BLK-M
        options_text:
          type: string
          description: Human-readable option combination for display
          examples:
            - Black / Medium
        unit_price:
          type: integer
          description: Price per unit in cents
          examples:
            - 2299
        quantity:
          type: integer
          examples:
            - 2
        subtotal:
          type: integer
          description: unit_price √ó quantity in cents (computed)
          examples:
            - 4598

    OrderSummary:
      type: object
      properties:
        id:
          type: string
          format: uuid
        status:
          type: string
          description: |
            Order status:
            - PENDING: Order created, awaiting payment
            - CANCELLED: Order cancelled
            - PAID: Payment confirmed
            - SHIPPED: Order dispatched
            - DELIVERED: Order received
          enum:
            - PENDING
            - CANCELLED
            - PAID
            - SHIPPED
            - DELIVERED
          examples:
            - PAID
        total_amount:
          type: integer
          description: Order total in cents
          examples:
            - 5000
        created_at:
          type: string
          format: date-time
        items_count:
          type: integer
          description: Number of items in the order (computed)
          examples:
            - 3

    OrderDetails:
      type: object
      properties:
        id:
          type: string
          format: uuid
        user_id:
          type: string
          format: uuid
        status:
          type: string
          description: |
            Order status workflow:
            - PENDING: Order created, awaiting payment
            - CANCELLED: Order cancelled by user or system
            - PAID: Payment confirmed
            - SHIPPED: Order dispatched for delivery
            - DELIVERED: Order received by customer
          enum:
            - PENDING
            - CANCELLED
            - PAID
            - SHIPPED
            - DELIVERED
          examples:
            - PAID
        total_amount:
          type: integer
          description: Order total in cents
          examples:
            - 5000
        created_at:
          type: string
          format: date-time
        shipping_address_snapshot:
          type: object
          description: Address captured at order time for historical accuracy (immutable)
          properties:
            address_line1:
              type: string
              examples:
                - 123 Tech Boulevard
            city:
              type: string
              examples:
                - San Salvador
            country:
              type: string
              examples:
                - SV
            postal_code:
              type: string
              examples:
                - "11011"
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'

    OrderItem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        product_name_snapshot:
          type: string
          description: Product name captured at purchase time (immutable)
          examples:
            - Developer T-Shirt
        variant_sku_snapshot:
          type: string
          description: SKU captured at purchase time (immutable)
          examples:
            - DEV-BLK-M
        unit_price_at_purchase:
          type: integer
          description: Price per unit in cents at time of purchase (immutable)
          examples:
            - 2299
        quantity:
          type: integer
          examples:
            - 2
        total_price:
          type: integer
          description: unit_price_at_purchase √ó quantity in cents
          examples:
            - 4598

    Payment:
      type: object
      properties:
        id:
          type: string
          format: uuid
        order_id:
          type: string
          format: uuid
        stripe_payment_intent_id:
          type: string
          description: Stripe payment intent ID
          examples:
            - pi_3L7W8K2eZvKylo2C1...
        status:
          type: string
          description: |
            Payment processing status:
            - PENDING: Payment intent created, awaiting confirmation
            - SUCCESS: Payment completed successfully
            - FAILED: Payment attempt failed
          enum:
            - PENDING
            - SUCCESS
            - FAILED
          examples:
            - SUCCESS
        amount:
          type: integer
          description: Payment amount in cents
          examples:
            - 5000
        currency:
          type: string
          description: Payment currency (ISO 4217)
          examples:
            - usd
        receipt_url:
          type:
            - string
            - "null"
          format: uri
          description: Stripe receipt URL (available after successful payment)
          examples:
            - https://pay.stripe.com/receipts/...
        payment_date:
          type:
            - string
            - "null"
          format: date-time

          description: Timestamp when payment was completed

    PaginationMeta:
      type: object
      properties:
        total:
          type: integer
          description: Total number of items across all pages
          examples:
            - 156
        page:
          type: integer
          description: Current page number (starts at 1)
          examples:
            - 1
        limit:
          type: integer
          description: Items per page (max 100)
          examples:
            - 20
        total_pages:
          type: integer
          description: Total number of pages
          examples:
            - 8
